

/*
 * @author Timur Valiyev
 * @link https://webprowww.github.io
 */

"use strict";(function(){var t;Vue.prototype.$delay=function(e,t){return setTimeout(t,e),!0},Vue.prototype.$axios=axios.create({baseURL:"/fid-parser/api/",responseType:"json"}),Vue.component("app-loader",{template:'<div class="loader" :class="{ active: isLoading }" > <img class="loader-img" height="8" src="/img/loader.svg" v-show="!isError" > <p class="loader-error" v-show="isError" > <i class="fas fa-exclamation-triangle"></i> <span v-html="msg"></span> </p> </div>',data:function(){return{isLoading:!1,isError:!1,msg:"&nbsp;",callBack:function(){}}},methods:{post:function(e,t,i){var n=this;return!this.isLoading&&(this.isLoading=!0,this.callBack=i,this.$axios({method:"post",url:e,data:t}).then(function(e){return n.isLoading=!1,n.$delay(160,function(){return n.isError=!1,n.msg="&nbsp;"}),n.callBack(e.data)}).catch(function(e){return n.msg=e.response,n.isError=!0,n.$delay(3e3,function(){return n.isLoading=!1}),n.$delay(3160,function(){return n.isError=!1,n.msg="&nbsp;"})}).then(function(){}),!0)}}}),Vue.component("app-button",{template:'<div class="col-12 col-sm"> <button class="btn btn-default" @click.prevent="click" >{{ button.label }}</button> </div>\x3c!-- /.col --\x3e',props:{button:{type:Object,required:!0}},methods:{click:function(){return this.$emit("click",this.button),!0}}}),Vue.component("app-btn-group",{template:'<div> <span class="label">Добавить ссылку на фид:</span> <div class="btn-group"> <app-button v-for="(button, i) in buttons" :key="i" :button="button" @click="click" /> </div>\x3c!-- /.btn-group --\x3e </div>',props:{buttons:{type:Array,required:!0}},methods:{click:function(e){return this.$emit("click",e)}}}),Vue.component("app-input",{template:'<div class="animated faster" :class="animClass" > <label class="label">{{ input.label }}</label> <div class="input-group"> <input type="text" class="input" :class="{error: input.error}" :name="input.name" @focus="input.error = false" > <a href="#" class="input-group-right ln-red" @click.prevent="remove" > <i class="fas fa-times"></i> </a> </div>\x3c!-- /.input-group --\x3e <span v-if="input.error" class="input-error">{{ input.error }}</span> </div>',props:{input:{type:Object,required:!0}},data:function(){return{error:!1,errorMsg:"",animClass:"fadeInDown"}},methods:{remove:function(){return this.$emit("remove",this),!0}}}),Vue.component("app-input-list",{template:'<div class="d-flex flex-column-reverse"> <app-input v-for="(input, i) in inputs" :key="input.id" :input="input" @remove="removeInput($event, i)" /> </div>\x3c!-- /.d-flex --\x3e',props:{inputs:{type:Array,required:!0}},methods:{removeInput:function(e,t){return this.$emit("remove",e,t),!0}}}),Vue.component("app-form",{template:'<div class="wall relative"> <app-btn-group :buttons="buttons" @click="addInput"/> <form @submit.prevent="send"> <app-input-list :inputs="inputs" @remove="removeInput" /> <div class="row animated faster" :class="submitAnimClass" v-show="showSubmit" > <div class="col-auto ml-auto"> <button class="btn btn-green" type="submit">Парсинг</button> </div> </div>\x3c!-- /.row --\x3e </form> <app-loader ref="loader"/> </div>\x3c!-- /.wall --\x3e',data:function(){return{inputs:[],inputId:0,submitAnimClass:"",showSubmit:!1}},methods:{addInput:function(e){var t;return 0===this.inputs.length&&(this.inputId=0),t=++this.inputId,this.inputs.push({label:e.label,name:"".concat(e.name,"[").concat(t,"]"),id:t,error:""}),1===this.inputs.length&&this.toggleSubmit(!0),!0},removeInput:function(e,t){var i=this;return 1===this.inputs.length&&this.toggleSubmit(!1),e.animClass="fadeOutUp",this.$delay(500,function(){return i.inputs.splice(t,1)}),!0},toggleSubmit:function(e){var t=this;return e?(this.submitAnimClass="fadeInUp",this.showSubmit=!0):(this.submitAnimClass="fadeOutDown",this.$delay(500,function(){return t.showSubmit=!1})),!0},send:function(e){var t,n=this;return t=new FormData(e.target),this.$refs.loader.post("parse.json",t,function(e){var s,r,a,t,i;if(null!=(null!=e?e.errors:void 0)){for(s in i=[],t=e.errors)a=t[s],i.push(function(){var e,t,i,n;for(n=[],e=0,t=(i=this.inputs).length;e<t;e++)r=i[e],Number(s)===r.id&&n.push(r.error=a[0]);return n}.call(n));return i}if(null!=(null!=e?e.xlsxFiles:void 0))return n.$emit("complete",e.xlsxFiles)}),!0}},computed:{buttons:function(){return[{label:"Yandex",name:"yandex"},{label:"Avito",name:"avito"},{label:"Cian",name:"cian"}]}}}),Vue.component("app-row",{template:'<div class="row-view animated faster" :class="animClass" > <div class="row-view-content"> <p class="text">{{ file.name }}</p> <p class="text red">{{ error }}</p> </div>\x3c!-- /.row-view-content --\x3e <div class="action"> <a class="action-btn delete" href="#" @click.prevent="remove" > <i class="fas fa-trash-alt"></i> </a> <a class="action-btn view" target="_blank" download :href="file.url" > <i class="fas fa-download"></i> </a> </div>\x3c!-- /.action --\x3e <app-loader ref="loader"/> </div>\x3c!-- /.row-view --\x3e',props:{file:Object,required:!0},data:function(){return{animClass:"",error:""}},methods:{remove:function(){var e,i=this;return(e=new FormData).set("xlsxFileName",this.file.name),this.$refs.loader.post("remove-xlsx.json",e,function(e){var t;return null!=(null!=e&&null!=(t=e.errors)?t.xlsxFileName:void 0)?(i.error=e.errors.xlsxFileName[0],i.$delay(3e3,function(){return i.error=""})):null!=(null!=e?e.status:void 0)&&!0===e.status&&(i.animClass="zoomOut",i.$delay(500,function(){return i.$emit("remove")})),!0})}}}),Vue.component("app-row-list",{template:'<div class="relative"> <p v-show="files.length" class="text">Excel - спарсенные данные</p> <app-row v-for="(file, i) in files" :file="file" :key="file.id" @remove="removeFile(i)" /> <app-loader ref="loader"/> </div>',props:{files:{type:Array,required:!0}},methods:{removeFile:function(e){return this.$emit("remove",e),!0}}}),t={template:'<div class="container"> <app-form @complete="updateXlsx" /> <app-row-list :files="xlsxFiles" @remove="removeFile" /> </div>\x3c!-- /.container --\x3e',data:function(){return{xlsxFiles:"undefined"!=typeof xlsxFiles&&null!==xlsxFiles?xlsxFiles:[]}},methods:{updateXlsx:function(e){return this.xlsxFiles=e,!0},removeFile:function(e){return this.xlsxFiles.splice(e,1),!0}}},new Vue({render:function(e){return e(t)}}).$mount("#app-fid-parser-index")}).call(void 0);


/*
 * @author Timur Valiyev
 * @link https://webprowww.github.io
 */

"use strict";function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,r,t){return r&&_defineProperties(e.prototype,r),t&&_defineProperties(e,t),e}(function(){var r,n,i;i=function(e,r){return setTimeout(r,e)},n=function(){var e=function(){function e(){_classCallCheck(this,e),this.post=this.post.bind(this),this.postEach=this.postEach.bind(this),this.success=this.success.bind(this),this.error=this.error.bind(this),this.allways=this.allways.bind(this),this.partSuccess=this.partSuccess.bind(this),this.partError=this.partError.bind(this),this.partAllways=this.partAllways.bind(this),this.partAllDone=this.partAllDone.bind(this),this.axios=axios.create({baseURL:"/fid-parser/api/",responseType:"json"})}return _createClass(e,[{key:"_callBackSuccess",value:function(){}},{key:"_callBackError",value:function(){}},{key:"_callBackAllways",value:function(){}},{key:"_callBackPartSuccess",value:function(){}},{key:"_callBackPartError",value:function(){}},{key:"_callBackPartAllways",value:function(){}},{key:"_callBackPartAllDone",value:function(){}}]),_createClass(e,[{key:"post",value:function(e,r){var l=this;return this.axios({method:"post",url:e,data:r}).then(function(e){return l._callBackSuccess(e.data),!0}).catch(function(e){var r,t,a;return r="Внутренняя ошибка системы",null!=(null!=(t=e.response)&&null!=(a=t.data)?a.message:void 0)&&""!==e.response.data.message&&(r=e.response.data.message),l._callBackError(r),!0}).then(function(){return l._callBackAllways(),!0}),this}},{key:"postEach",value:function(e,r,t){var a,l=this,i=2<arguments.length&&void 0!==t?t:0;return a=r.length===i+1,r.length||(a=!0),this.axios({method:"post",url:e,data:r[i]}).then(function(e){return l._callBackPartSuccess(e.data,i),a&&l._callBackSuccess(null),!0}).catch(function(e){var r,t,a;return r="Внутренняя ошибка системы",null!=(null!=(t=e.response)&&null!=(a=t.data)?a.message:void 0)&&""!==e.response.data.message&&(r=e.response.data.message),l._callBackPartError(r,i),!0}).then(function(){return l._callBackPartAllways(),a?l._callBackPartAllDone():l.postEach(e,r,i+1),!0}),this}},{key:"success",value:function(e){return this._callBackSuccess=e,this}},{key:"error",value:function(e){return this._callBackError=e,this}},{key:"allways",value:function(e){return this._callBackAllways=e,this}},{key:"partSuccess",value:function(e){return this._callBackPartSuccess=e,this}},{key:"partError",value:function(e){return this._callBackPartError=e,this}},{key:"partAllways",value:function(e){return this._callBackPartAllways=e,this}},{key:"partAllDone",value:function(e){return this._callBackPartAllDone=e,this}}]),e}();return e.prototype.axios={},e.prototype._i=0,e}.call(this),Vue.config.productionTip=!1,Vue.component("app-xml-xlsx",{template:'<div> <div class="wall relative"> <span class="label">Добавить ссылку на фид (xml):</span> <div class="btn-group"> <div class="col-12 col-sm" v-for="(button, i) in buttons" :key="i"> <button class="btn btn-default" @click.prevent="addInput(button)"> {{ button.label }} </button> </div>\x3c!-- /.col --\x3e </div>\x3c!-- /.btn-group --\x3e <div class="d-flex flex-column-reverse"> <div v-for="(input, i) in inputs"> <label class="label">{{ input.label }}</label> <div class="input-group"> <input type="text" class="input" autocomplete="off" v-model.trim="input.val" :class="{error: input.error}" @focus="input.error = false" > <a class="input-group-right ln-red" href="#" @click.prevent="removeInput(i)"> <i class="fas fa-times"></i> </a> </div>\x3c!-- /.input-group --\x3e <span v-if="input.error" class="input-error">{{ input.error }}</span> </div>\x3c!-- v-for inputs --\x3e </div>\x3c!-- /.d-flex --\x3e <div class="row" v-if="showSubmit"> <div class="col-auto ml-auto"> <a class="btn btn-green" href @click.prevent="send">Парсинг</a> </div> </div>\x3c!-- /.row --\x3e </div>\x3c!-- /.wall --\x3e <p v-show="files.length" class="text">Excel - спарсенные данные</p> <div class="row-view" v-for="(file, i) in files"> <div class="row-view-content"> <p class="text">{{ file.name }}</p> </div>\x3c!-- /.row-view-content --\x3e <div class="action"> <a class="action-btn delete" href="#" @click.prevent="removeFile(file, i)"> <i class="fas fa-trash-alt"></i> </a> <a class="action-btn view" target="_blank" download :href="file.url"> <i class="fas fa-download"></i> </a> </div>\x3c!-- /.action --\x3e <div class="loader" :class="{ active: file.loader.active }"> <img class="loader-img" height="6" src="/img/loader.svg" v-if="!file.loader.error"> <p class="loader-error" v-if="file.loader.error"> <i class="fas fa-exclamation-triangle"></i> <span v-html="file.loader.error"></span> </p> </div> </div>\x3c!-- /.row-view --\x3e <div class="loader fixed" :class="{ active: loader.active }"> <img class="loader-img" height="6" src="/img/loader.svg"> <p class="loader-info" v-if="loader.info"> <span v-html="loader.info"></span> </p> <p class="loader-error" v-if="loader.error"> <i class="fas fa-exclamation-triangle"></i> <span v-html="loader.error"></span> </p> </div> </div>\x3c!-- /.root --\x3e',created:function(){return this.addXlsxFiles(),!0},data:function(){return{files:[],inputs:[],showSubmit:!1,loader:{active:!1,info:"",error:""}}},methods:{addInput:function(e){return this.inputs.push({label:e.label,name:e.name,error:!1,val:""}),1===this.inputs.length&&(this.showSubmit=!0),!0},removeInput:function(e){return 1===this.inputs.length&&(this.showSubmit=!1),this.inputs.splice(e,1),!0},send:function(){var e,l,a=this;return this.loader.active=!0,e=function(){var e,r,t,a;for(a=[],e=0,r=(t=this.inputs).length;e<r;e++)l=t[e],a.push(_defineProperty({},"".concat(l.name,"XmlUrl"),l.val));return a}.call(this),(new n).postEach("parse-xml.json",e).partSuccess(function(e,r){var t;return null!=(null!=e&&null!=(t=e.errors)?t.processErrors:void 0)?a.inputs[r].error=e.errors.processErrors[0]:null!=(null!=e?e.xlsxFiles:void 0)&&a.addXlsxFiles(e.xlsxFiles),a.loader.info="Обработано ".concat(r+1," из ").concat(a.inputs.length),!0}).partError(function(e,r){return a.inputs[r].error=e,!0}).partAllDone(function(){return a.loader.active=!1,a.loader.info="",a.loader.error="",a.inputs=a.inputs.filter(function(e){return!!e.error}),0===a.inputs.length&&(a.showSubmit=!1),!0}),!0},removeFile:function(t,a){var l=this;return t.loader.active=!0,(new n).post("remove-xlsx.json",{xlsxFileName:t.name}).success(function(e){var r;return null!=(null!=e&&null!=(r=e.errors)?r.xlsxFileName:void 0)?(t.loader.error=e.errors.xlsxFileName[0],i(3e3,function(){return t.loader.active=!1,t.loader.error=""})):null!=(null!=e?e.status:void 0)&&!0===e.status&&(l.files.splice(a,1),l.addXlsxFiles(l.files)),!0}).error(function(e){return t.loader.error=e,i(3e3,function(){return t.loader.active=!1,t.loader.error=""}),!0}),!0},addXlsxFiles:function(e){var l,r=0<arguments.length&&void 0!==e&&e;return r&&(window.xlsxFiles=r),null!=window.xlsxFiles&&window.xlsxFiles.length?this.files=function(){var e,r,t,a;for(a=[],e=0,r=(t=window.xlsxFiles).length;e<r;e++)(l=t[e]).loader={active:!1,error:""},a.push(l);return a}():this.files=[],!0}},computed:{buttons:function(){return[{label:"Yandex",name:"yandex"},{label:"Avito",name:"avito"},{label:"Cian",name:"cian"}]}}}),Vue.component("app-xlsx-xml",{template:'<div> <div class="wall relative"> <span class="label">Добавить файл Excel (xlsx):</span> <div class="btn-group"> <div class="col-12 col-sm" v-for="(button, i) in buttons" :key="i"> <button class="btn btn-default" @click.prevent="addInput(button)"> {{ button.label }} </button> </div>\x3c!-- /.col --\x3e </div>\x3c!-- /.btn-group --\x3e <div v-for="(input, i) in inputs"> <label class="label">{{ input.label }}</label> <div class="input-group"> <div class="input" :class="{error: input.error}"> {{ input.fileName }} </div> <a class="input-group-right ln-red" href="#" @click.prevent="removeInput(i)"> <i class="fas fa-times"></i> </a> </div>\x3c!-- /.input-group --\x3e <span v-if="input.error" class="input-error">{{ input.error }}</span> </div> <div class="row" v-if="showSubmit"> <div class="col-auto ml-auto"> <a class="btn btn-green" href @click.prevent="send">Конвертировать</a> </div> </div>\x3c!-- /.row --\x3e </div>\x3c!-- /.wall --\x3e <p v-show="files.length" class="text">XML - конвертированные файлы</p> <div class="row-view" v-for="(file, i) in files"> <div class="row-view-content"> <p class="text">{{ file.name }}</p> </div>\x3c!-- /.row-view-content --\x3e <div class="action"> <a class="action-btn delete" href="#" @click.prevent="removeFile(file, i)"> <i class="fas fa-trash-alt"></i> </a> <a class="action-btn update" target="_blank" download :href="file.url"> <i class="fas fa-download"></i> </a> <a class="action-btn view" target="_blank" :href="file.url"> <i class="fas fa-link"></i> </a> </div>\x3c!-- /.action --\x3e <div class="loader" :class="{ active: file.loader.active }"> <img class="loader-img" height="6" src="/img/loader.svg" v-if="!file.loader.error"> <p class="loader-error" v-if="file.loader.error"> <i class="fas fa-exclamation-triangle"></i> <span v-html="file.loader.error"></span> </p> </div> </div>\x3c!-- /.row-view --\x3e <div class="loader fixed" :class="{ active: loader.active }"> <img class="loader-img" height="6" src="/img/loader.svg"> <p class="loader-info" v-if="loader.info"><span v-html="loader.info"></span></p> <p class="loader-error" v-if="loader.error"> <i class="fas fa-exclamation-triangle"></i> <span v-html="loader.error"></span> </p> </div> </div>\x3c!-- /.root --\x3e',created:function(){return this.addXmlFiles(),!0},data:function(){return{files:[],inputs:[],showSubmit:!1,loader:{active:!1,info:"",error:""}}},methods:{addInput:function(r){var t,a=this;return(t=document.createElement("input")).type="file",t.accept=".xlsx",t.onchange=function(){var e;return e=t.files[0],a.inputs.push({label:r.label,fileName:e.name,error:"",name:r.name,file:e}),1===a.inputs.length&&(a.showSubmit=!0),!0},t.click(),!0},removeInput:function(e){return 1===this.inputs.length&&(this.showSubmit=!1),this.inputs.splice(e,1),!0},addXmlFiles:function(e){var l,r=0<arguments.length&&void 0!==e&&e;return r&&(window.xmlFiles=r),null!=window.xmlFiles&&window.xmlFiles.length?this.files=function(){var e,r,t,a;for(a=[],e=0,r=(t=window.xmlFiles).length;e<r;e++)(l=t[e]).loader={active:!1,error:""},a.push(l);return a}():this.files=[],!0},send:function(){var e,l,i,a=this;return this.loader.active=!0,e=function(){var e,r,t,a;for(a=[],e=0,r=(t=this.inputs).length;e<r;e++)i=t[e],(l=new FormData).set("".concat(i.name,"XlsxFile"),i.file),a.push(l);return a}.call(this),(new n).postEach("parse-xlsx.json",e).partSuccess(function(e,r){var t;return null!=(null!=e&&null!=(t=e.errors)?t.processErrors:void 0)?a.inputs[r].error=e.errors.processErrors[0]:null!=(null!=e?e.xmlFiles:void 0)&&a.addXmlFiles(e.xmlFiles),a.loader.info="Обработано ".concat(r+1," из ").concat(a.inputs.length),!0}).partError(function(e,r){return a.inputs[r].error=e,!0}).partAllDone(function(){return a.loader.active=!1,a.loader.info="",a.loader.error="",a.inputs=a.inputs.filter(function(e){return!!e.error}),0===a.inputs.length&&(a.showSubmit=!1),!0}),!0},removeFile:function(t,a){var l=this;return t.loader.active=!0,(new n).post("remove-xml.json",{xmlFileName:t.name}).success(function(e){var r;return null!=(null!=e&&null!=(r=e.errors)?r.xmlFileName:void 0)?(t.loader.error=e.errors.xmlFileName[0],i(3e3,function(){return t.loader.active=!1,t.loader.error=""})):null!=(null!=e?e.status:void 0)&&!0===e.status&&(l.files.splice(a,1),l.addXmlFiles(l.files)),!0}).error(function(e){return t.loader.error=e,i(3e3,function(){return t.loader.active=!1,t.loader.error=""}),!0}),!0}},computed:{buttons:function(){return[{label:"Yandex",name:"yandex"},{label:"Avito",name:"avito"},{label:"Cian",name:"cian"}]}}}),r={template:'<div class="container"> <div class="tab"> <a class="tab-ln" href="#" v-for="tab in tabs" :class="{ active: tab.active }" @click.prevent="showComponent(tab.name)" ><span v-html="tab.label"></span></a> </div> <component :is="currentComponent"></component> </div>\x3c!-- /.container --\x3e',data:function(){return{tabs:[{name:"app-xml-xlsx",label:'XML <i class="fas fa-chevron-right"></i> XLSX',active:!1},{name:"app-xlsx-xml",label:'XLSX <i class="fas fa-chevron-right"></i> XML',active:!0}],currentComponent:"app-xlsx-xml"}},methods:{showComponent:function(e){var r,t,a,l;for(r=0,t=(a=this.tabs).length;r<t;r++)(l=a[r]).active=e===l.name;return this.currentComponent=e}}},new Vue({render:function(e){return e(r)}}).$mount("#app-fid-parser-index")}).call(void 0);